---
title: "Nucleotide_Diversity"
author: "Silas"
date: "2025-09-23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = '~/projects/eco_genomics_2025/population_genomics/myresults/ANGSD/diversity/')
```

Import our libraries for plotting 


```{r}

library(ggplot2)
library(tidyverse)
```


Read in our theta outputs 
```{r}
theta <-read.table('2022_ALL_win50000_step50000.thetas',header=T, sep='\t')

head(theta)


```

First we need to scale our theta by n sites

```{r}
theta$tWsite = theta$tW/theta$nSites   #scaling watersons theta by nsites
theta$tPsite = theta$tP/theta$nSites 



```

```{r}
summary(theta)

theta2<-theta %>% 
  arrange(Chr, WinCenter) %>% 
  filter(nSites>100) 
summary(theta2)
  

```

Lets plot a histogram of how many sites are in each window 

```{r}
histo1<-ggplot(theta2, aes(nSites))+
  geom_histogram(bin=50, fill='lightblue',color='black')+
  geom_vline(xintercept = median(theta2$nSites), color='red', linetype='dashed')+
  labs(title='Distribution of windows with data', x='Number of sites in 50 kb windows', y='Frequency')
histo1
```
Lets Plot nucleotide diversity as Pi 

```{r}
ggplot(theta2, aes(x=Chr, y=tPsite, color=Chr))+
  geom_point(size=0.75, shape=1, show.legend = F)+
  ylim(0,0.07)+
  labs(title='Nucleotide Diversity in 50 kb windows for pop 2022', x='scaffold', y='Theta Pi')

```

```{r}
#compare pi and theta-W together and look for deviation 

ggplot(theta2, aes(x=tWsite, y=tPsite, color=Chr))+
  geom_point(size=0.75, shape=1, show.legend = F)+
  geom_abline(slope=1, intercept = 0, linetype='dashed',color='black')+
  labs(title='Pairwise Differences vs Segregating Sites for Pop 2022', x='Theta-W', y='Theta-Pi')


```
Which windows have evidence of negative D and low nucleotide diversity
Strong negative D and low nucleotide diversity is evidence of selective sweep 

```{r}
theta2[which(theta2$Tajima < -1.5 & theta2$tPsite<0.001),]
```
```{r}
summary(theta2)
sum(theta2$nSites)

# solve for effective pop with mutation rate and Big Theta 

# mutation rate in spruce is 2.5*10^-9
# reproduction age is 30 years 
# coeficient is 2 since spruce is a diploid and 2 which is inheritence 
# Ne = BigTheta / ((2.5*10^-9)(30)(2))

```

Pull out extremes of Tajimas D 

```{r}
BigD = theta2[which(theta2$Tajima== max(theta2$Tajima)),]
SmallD = theta2[which(theta2$Tajima== min(theta2$Tajima)),]


```



